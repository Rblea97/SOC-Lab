# MPS Python Automation Scaffold

This repository is a **phase-gated, spec-driven** workflow for building Python projects with strong automation:
- `uv` for env + deps
- `ruff` for format + lint
- `pyright` for types
- `pytest` for tests
- `pip-audit` for vuln scanning (deterministic input)
- `pre-commit` for local enforcement
- `nox` for one-command gates
- GitHub Actions for CI

The workflow is governed by the prompts in `_MPS/`.

---

## Quick start (local)

```bash
python -m pip install -U pip uv
uv venv
uv pip install -e ".[dev]"

uv tool install pre-commit --with pre-commit-uv
pre-commit install

# initialize lock + deterministic audit input once
uv lock
uv export --frozen --no-dev --output-file requirements-audit.txt

# run all gates
uv run nox -s all
```

---

## One-command checks

```bash
uv run nox -s all
```

Individual gates:

```bash
uv run nox -s fmt
uv run nox -s lint
uv run nox -s type
uv run nox -s test
uv run nox -s audit
```

---

## How to use the MPS system with ChatGPT (best output)

**Rule:** run each phase in a fresh chat (phase isolation). Only pass repo files (SPECS/PLAN/TASKS/etc.) between phases.

### Phase 1 — ARCHITECT (no code)
Paste into a new chat:

```
PHASE: ARCHITECT
Read _MPS/SYS_ARCHITECT.md and follow it strictly.
You are forbidden from writing code.

User Query:
<describe the project>

Output only:
- docs/SPECS.md
- docs/PLAN.md
- docs/TASKS.md
- docs/adr/ADR-0001-*.md if needed
STOP and wait for approval.
```

After you approve, copy the outputs into the repo and commit.

### Phase 1.5 — SKILL INJECTOR (best practices + forbidden patterns)
New chat:

```
PHASE: SKILL_INJECTOR
Read _MPS/SYS_SKILL_LIBRARY.md and follow it strictly.

Given docs/PLAN.md, produce:
- _MPS/SKILLS.md
- Dependency Map
- Forbidden Patterns (Python)
STOP.
```

Copy into `_MPS/SKILLS.md` and commit.

### Phase 2 — IMPLEMENTER (task-by-task only)
New chat:

```
PHASE: IMPLEMENTER
Read _MPS/SYS_IMPLEMENTER.md and follow it strictly.

Execute only TASK-001 from docs/TASKS.md.
Do not proceed to any other task.

Output:
- exact file edits for allowed files
- commands to run
STOP after TASK-001.
```

Apply changes locally, run `uv run nox -s all`, then commit.
Repeat for TASK-002, TASK-003, etc.

### Phase 3 — DEBUGGER (only on failures)
New chat:

```
PHASE: DEBUGGER
Read _MPS/SYS_DEBUGGER.md and follow it strictly.
No new features.

Here is:
- failing command output
- relevant file(s)
- task ID

Produce:
- docs/TEST_REPORT.md
- minimal patch suggestion
STOP.
```

Apply patch, rerun `uv run nox -s all`, commit fix.

### Phase 4 — MEMORY_KEEPER (compaction + resume prompt)
Use every 5–10 tasks or before pausing work.
New chat:

```
PHASE: MEMORY_KEEPER
Read _MPS/SYS_MEMORY_KEEPER.md and follow it strictly.

Based on:
- docs/SPECS.md
- docs/PLAN.md
- docs/TASKS.md
- docs/adr/*
- docs/CHANGELOG.md
- docs/CURRENT_STATE.md
Produce:
- updated AGENTS.md
- updated docs/CURRENT_STATE.md
- Resume Prompt
STOP.
```

Copy outputs into repo and commit. Start a fresh chat next time using the Resume Prompt.

---

## Why phase isolation matters

The modules define different reasoning modes (planning vs execution vs debugging vs compaction). Separate chats reduce role bleed and drift.

---

## Repo structure

- `_MPS/` – system prompts and skills library
- `docs/` – specs, plan, tasks, ADRs, state, changelog
- `src/` – application code
- `tests/` – test suite
- `.github/workflows/` – CI

---

## Notes

- `uv.lock` is created/updated by the `uv-lock` pre-commit hook.
- `requirements-audit.txt` is generated by `uv-export` pre-commit hook and used by `pip-audit`.
